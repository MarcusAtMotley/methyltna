report_comment: >
  This report has been generated by the <a href="https://github.com/Motleybio-organization/methyltna" target="_blank">Motleybio-organization/methyltna</a>
  TNA-EM-seq analysis pipeline.

# Custom logo configuration
custom_logo: "/home/marcus/MotleyBioLogo.png"
custom_logo_url: "https://www.motley.bio"
custom_logo_title: "Motley Bio"

# Module order following methyltna TNA-EM-seq pipeline workflow
module_order:
  # 1. Initial QC
  - fastqc:
      name: 'FastQC (Raw Reads)'
      info: 'Quality control metrics for raw, unprocessed sequencing reads before any processing.'
      path_filters:
        - '**/*_fastqc.zip'

  # 2. Read Trimming (Quality & Adapter Trimming)
  - cutadapt:
      name: 'TrimGalore (Read Trimming)'
      info: 'Quality and adapter trimming statistics for all reads using TrimGalore with NextSeq 2-color chemistry settings.'
      path_filters:
        - '**/*_trimming_report.txt'

  # 3. RNA Barcode Extraction (TNA Deconvolution)
  - cutadapt:
      name: 'RNA Barcode Extraction'
      info: 'RNA barcode extraction statistics from TNA deconvolution, separating barcoded (RNA) from unbarcoded (DNA) reads.'
      path_filters:
        - '**/*.cutadapt.txt'
      path_filters_exclude:
        - '**/*_[12].fastq.gz_trimming_report.txt'
        - '**/*_hairpin_*.fastq.gz_trimming_report.txt'

  # 6. RNA Barcode Statistics (Custom Content) - Auto-detected
  # Removed from module_order to avoid duplicates - MultiQC will auto-detect from file headers

  # 7. STAR Alignment (RNA reads, splice-aware)
  - star:
      name: 'STAR Alignment (RNA Reads)'
      info: 'Splice-aware alignment statistics for barcoded RNA reads using STAR aligner with GTF annotations.'
      path_filters:
        - '**/*Log.final.out'

  # 8. FeatureCounts (Gene Quantification for RNA)
  - featurecounts:
      name: 'FeatureCounts (Gene Quantification)'
      info: 'Gene-level read counting for RNA samples, showing assignment rates and feature types.'
      path_filters:
        - '**/*.featureCounts.tsv.summary'

  # 8b. RSeQC (RNA-seq Quality Control)
  - rseqc:
      name: 'RSeQC (RNA-seq QC)'
      info: 'Comprehensive RNA-seq quality control including read distribution across genomic features, gene body coverage uniformity, inner distance analysis, and BAM statistics.'
      path_filters:
        - '**/*.read_distribution.txt'
        - '**/*.geneBodyCoverage.txt'
        - '**/*.inner_distance_freq.txt'
        - '**/*.bam_stat.txt'

  # 9. SAMtools Statistics (RNA Alignment QC)
  - samtools:
      name: 'SAMtools Statistics (RNA)'
      info: 'BAM file statistics for RNA reads including mapping rates, properly paired reads, and chromosome coverage.'
      path_filters:
        - '**/*_barcoded.flagstat'
        - '**/*_barcoded.idxstats'

  # 9b. SAMtools Statistics (DNA Alignment QC)
  - samtools:
      name: 'SAMtools Statistics (DNA)'
      info: 'BAM file statistics for DNA reads after Biscuit alignment and deduplication, including mapping rates and chromosome coverage.'
      path_filters:
        - '**/*_unbarcoded*.flagstat'
        - '**/*_unbarcoded*.idxstats'

  # 10. Biscuit Alignment (DNA reads, EM-seq)
  - biscuit:
      name: 'Biscuit (DNA Alignment & Methylation QC)'
      info: 'EM-seq alignment and methylation quality control metrics for unbarcoded DNA reads, including CpG retention, strand bias, and conversion rates.'
      path_filters:
        - '**/*_CpGRetentionByReadPos.txt'
        - '**/*_CpHRetentionByReadPos.txt'
        - '**/*_totalReadConversionRate.txt'
        - '**/*_mapq_table.txt'
        - '**/*_strand_table.txt'
        - '**/*_isize_table.txt'
        - '**/*_dup_report.txt'

  # 11. Picard MarkDuplicates (DNA Deduplication)
  - picard:
      name: 'Picard MarkDuplicates (DNA)'
      info: 'Duplicate marking statistics for DNA reads showing library complexity and PCR duplicate rates.'
      path_filters:
        - '**/*.metrics.txt'

  # 12. LoFreq Variant Calling Statistics (Custom Content) - Auto-detected
  # Removed from module_order to avoid duplicates - MultiQC will auto-detect from file headers

# Sample name cleaning - normalize all sample names to base sample name
# Clean up concatenated paired-end names from RNA barcode extraction
# e.g., "Sample_1_val_1_Sample_2_val_2" -> "Sample"
sample_names_rename:
  - type: regex
    pattern: '^(.+?)_1_val_1_\1_2(?:_val_2)?$'
    replace: '\1'

# Consolidate paired-end reads and TNA processing steps in General Statistics table
# This merges multiple sample rows into single rows with expandable details
# Using regex with end-of-string anchor ($) to avoid matching sample names that naturally contain _1 or _2
table_sample_merge:
  "Read 1":
    - type: regex
      pattern: "_1$"
  "Read 2":
    - type: regex
      pattern: "_2$"
  "Trimmed":
    - type: regex
      pattern: "_trimmed$"
  "Barcoded (RNA)":
    - type: regex
      pattern: "_barcoded$"
  "Unbarcoded (DNA)":
    - type: regex
      pattern: "_unbarcoded$"
  "RNA Barcode Extraction":
    - type: regex
      pattern: "_1_val_1_.*_2$"

# Customize column header names in General Statistics table
table_columns_name:
  trimgalore:
    percent_trimmed: "Trimmed Adapter Bases"
  rna_barcode_extraction:
    percent_trimmed: "RNA Barcode Bases"

# Module-specific configurations
fastqc_config:
  # Keep default settings but ensure both raw and trimmed are processed
  top_overrepresented_sequences: 20

report_section_order:
  "Motleybio-organization-modulestesting-methods-description":
    order: -1000
  software_versions:
    order: -1001
  "Motleybio-organization-modulestesting-summary":
    order: -1002

# RSeQC-specific configuration
rseqc_config:
  read_distribution_plot:
    # Rename all category labels for better clarity and readability
    CDS_Exons: 'CDS Exons'
    5'UTR_Exons: "5' UTR Exons"
    3'UTR_Exons: "3' UTR Exons"
    Introns: 'Introns'
    TSS_up_1kb: 'TSS ±1kb'
    TSS_up_1kb-5kb: 'TSS 1-5kb Upstream'
    TSS_up_5kb-10kb: 'TSS 5-10kb Upstream'
    TES_down_1kb: 'TES ±1kb'
    TES_down_1kb-5kb: 'TES 1-5kb Downstream'
    TES_down_5kb-10kb: 'TES 5-10kb Downstream'
    Other_intergenic: 'Deep Intergenic (>10kb)'

export_plots: true

disable_version_detection: true
