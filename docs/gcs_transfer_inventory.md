# GCS to S3 Transfer Inventory

**Date Created:** 2025-11-21
**Total Data Size:** ~3.69 TiB
**Estimated Egress Cost:** ~$426 (covered by GCS credits ✓)

---

## Transfer Items

### 1. ASSAY_DEVELOPMENT Data (Priority: HIGH)
**Source:** `gs://motleybio/Laboratory/ASSAY_DEVELOPMENT/`
**Destination:** `s3://motleybio/Laboratory/ASSAY_DEVELOPMENT/`
**Size:** 3.63 TiB (3,897 GiB)
**Priority:** Must transfer - primary assay development data
**Contains:** Experimental data, analysis outputs, validation results

**Transfer Command:**
```bash
rclone sync \
  gcs:motleybio/Laboratory/ASSAY_DEVELOPMENT/ \
  s3:motleybio/Laboratory/ASSAY_DEVELOPMENT/ \
  --progress --stats 30s --transfers 16 --checkers 32 --checksum \
  --log-file ~/rclone-assay-dev-$(date +%Y%m%d-%H%M%S).log
```

---

### 2. Reference Genome Files (Priority: HIGH)

#### 2a. GRCh38 Genome FASTA
**Source:** `gs://motleybio/Resources/reference_genome/GRCh38_full_analysis_set_plus_decoy_hla.fa`
**Destination:** `s3://motleybio/reference_genome/GRCh38_full_analysis_set_plus_decoy_hla.fa`
**Size:** 3.04 GiB
**Priority:** Must transfer - required for methylTNA pipeline
**Used by:** STAR alignment, Biscuit methylation, variant calling

#### 2b. RSEM Transcriptome FASTA
**Source:** `gs://motleybio/Resources/RSEM_Genome/RSEM_hg38.transcripts.fa`
**Destination:** `s3://motleybio/RSEM_Genome/RSEM_hg38.transcripts.fa`
**Size:** 427.63 MiB
**Priority:** Must transfer - required for methylTNA pipeline
**Used by:** RNA quantification, transcript-level analysis

#### 2c. Homo sapiens Annotation GTF
**Source:** `gs://motleybio/Resources/GTF/Homo_sapiens.GRCh38.112.chr_label.gtf`
**Destination:** `s3://motleybio/GTF/Homo_sapiens.GRCh38.112.chr_label.gtf`
**Size:** 1.41 GiB
**Priority:** Must transfer - required for methylTNA pipeline
**Used by:** STAR genome generation, feature counting, annotation

**Transfer Command (all reference files):**
```bash
rclone sync \
  gcs:motleybio/Resources/ \
  s3:motleybio-references/Resources/ \
  --progress --stats 30s --transfers 8 --checkers 16 --checksum \
  --log-file ~/rclone-references-$(date +%Y%m%d-%H%M%S).log
```

---

### 3. Pre-built Indexes Cache (Priority: MEDIUM)
**Source:** `gs://motleybio/Workspaces/Marcus/methyltna_references`
**Destination:** `s3://motleybio/methyltna_references`
**Size:** 55.74 GiB
**Priority:** Optional - saves ~2-3 hours of index building on first run
**Contains:** Pre-built STAR indexes, Biscuit indexes, FASTA indexes

**Note:** These can be regenerated by the pipeline on first run if not transferred. However, transferring saves significant compute time on AWS.

**Transfer Command:**
```bash
rclone sync \
  gcs:motleybio/Workspaces/Marcus/methyltna_references/ \
  s3:motleybio-references/methyltna_references/ \
  --progress --stats 30s --transfers 16 --checkers 32 --checksum \
  --log-file ~/rclone-indexes-$(date +%Y%m%d-%H%M%S).log
```

---

## Transfer Summary

| Item | Source | Size | Priority | Egress Cost |
|------|--------|------|----------|-------------|
| ASSAY_DEVELOPMENT | gs://motleybio/Laboratory/ | 3.63 TiB | HIGH | ~$403 |
| Reference Genome | gs://motleybio/Resources/reference_genome/ | 3.04 GiB | HIGH | ~$0.37 |
| Transcriptome | gs://motleybio/Resources/RSEM_Genome/ | 427.63 MiB | HIGH | ~$0.05 |
| Annotation GTF | gs://motleybio/Resources/GTF/ | 1.41 GiB | HIGH | ~$0.17 |
| Pre-built Indexes | gs://motleybio/Workspaces/Marcus/ | 55.74 GiB | MEDIUM | ~$6.69 |
| **TOTAL** | | **~3.69 TiB** | | **~$410** |

---

## Cost Analysis

**GCS Egress Pricing (North America → Internet):**
- First 1 TiB: $0.12/GiB × 1,024 GiB = **$122.88**
- Next 2.69 TiB: $0.11/GiB × 2,754 GiB = **$302.94**
- **Total Egress Cost: ~$425.82**

**AWS S3 Storage Cost (us-east-1, Standard):**
- 3.69 TiB × $0.023/GB/month = **~$87/month**
- Alternative: S3 Intelligent-Tiering (auto-optimizes) = **~$60-70/month**

**Total First Month Cost:**
- Egress (one-time): ~$426
- Storage (monthly): ~$87
- **Total: ~$513** (one-time + first month)

**GCS Credits Available:** Sufficient to cover egress ✓

---

## Transfer Timeline Estimate

**Based on:**
- Total data: 3.69 TiB
- Average network speed: 500 Mbps (62.5 MB/s)
- Parallelism: 16 concurrent transfers

**Estimated Transfer Times:**
1. ASSAY_DEVELOPMENT (3.63 TiB): ~17-24 hours
2. Reference files (4.87 GiB): ~5-10 minutes
3. Pre-built indexes (55.74 GiB): ~2-3 hours

**Total Estimated Time: 20-28 hours (~1-1.5 days)**

---

## Transfer Execution Plan

### Phase 1: High-Priority Items (Required for Pipeline)
- [ ] **Step 1.1:** Transfer ASSAY_DEVELOPMENT data (3.63 TiB)
  - Start in screen/tmux session
  - Estimated: 17-24 hours
  - Monitor with `tail -f ~/rclone-assay-dev-*.log`

- [ ] **Step 1.2:** Transfer reference genome files (4.87 GiB)
  - Can run in parallel with Step 1.1
  - Estimated: 5-10 minutes
  - Quick verification: `aws s3 ls s3://motleybio/Resources/`

### Phase 2: Optional Items (Performance Optimization)
- [ ] **Step 2.1:** Transfer pre-built indexes (55.74 GiB)
  - Only after Phase 1 complete
  - Estimated: 2-3 hours
  - Alternative: Let pipeline rebuild on first AWS run

### Phase 3: Verification
- [ ] **Step 3.1:** Verify ASSAY_DEVELOPMENT transfer
  ```bash
  rclone check gcs:motleybio/Laboratory/ASSAY_DEVELOPMENT/ \
    s3:motleybio/Laboratory/ASSAY_DEVELOPMENT/ \
    --one-way --checksum
  ```

- [ ] **Step 3.2:** Verify reference files transfer
  ```bash
  rclone check gcs:motleybio/Resources/ \
    s3:motleybio/Resources/ \
    --one-way --checksum
  ```

- [ ] **Step 3.3:** Update methylTNA nextflow.config with S3 paths
  ```groovy
  params {
      genome_fasta = "s3://motleybio/Resources/reference_genome/GRCh38_full_analysis_set_plus_decoy_hla.fa"
      transcriptome_fasta = "s3://motleybio/Resources/RSEM_Genome/RSEM_hg38.transcripts.fa"
      annotation_gtf = "s3://motleybio/Resources/GTF/Homo_sapiens.GRCh38.112.chr_label.gtf"
      cloud_reference_cache = "s3://motleybio/Workspaces/Marcus/methyltna_references"
  }
  ```

---

## Notes

**Size Correction:** Original estimate was ~10TB, but actual measurement shows **3.69 TiB** - much better for transfer costs and timeline!

**Pre-built Indexes Decision:**
- **Transfer (recommended):** Saves 2-3 hours of STAR/Biscuit index building on first AWS run
- **Skip:** Pipeline will automatically build indexes on first run and cache them in S3

**GCS Credits:** Estimated $426 egress cost is well within available GCS credits ✓

**Resumability:** All rclone commands are resumable - if interrupted, re-run the same command and it will continue from where it left off.

---

## Completion Checklist

- [ ] Phase 1.1: ASSAY_DEVELOPMENT transferred and verified
- [ ] Phase 1.2: Reference files transferred and verified
- [ ] Phase 2.1: Pre-built indexes transferred (optional)
- [ ] Phase 3: All transfers verified with checksums
- [ ] nextflow.config updated with S3 paths
- [ ] Test run on AWS with transferred references
- [ ] Document actual transfer time and costs
- [ ] Archive transfer logs to S3

**Migration Status:** ☐ Not Started ☐ In Progress ☐ Complete

**Actual Transfer Time:** __________ hours
**Actual Egress Cost:** $__________
**Issues Encountered:** ____________________________________________
